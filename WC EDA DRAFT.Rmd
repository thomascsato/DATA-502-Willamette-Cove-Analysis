---
title: "WC EDA"
author: "Thomas Sato"
date: "2024-10-26"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Import packages
```{r}
library(tidyverse)
library(sf)
```

Read in data
```{r}
# Shapefile paths

MHWLJP_path <- "320001056-18 (App. C Grids)5 - Standard/2012_MHWLJPCopy.shp"
Lines_Parcels_path <- "320001056-18 (App. C Grids)5 - Standard/Lines_Parcels.shp"
Lower_parcel_boundary_path <- "320001056-18 (App. C Grids)5 - Standard/Lower_parcel_boundary.shp"
Ordinary_HighWLJP_path <- "320001056-18 (App. C Grids)5 - Standard/Ordinary_HighWLJP.shp"
Ordinary_LowWLJP_path <- "320001056-18 (App. C Grids)5 - Standard/Ordinary_LowWLJP.shp"
RA_Polygons_path <- "320001056-18 (App. C Grids)5 - Standard/RA_Polygons.shp"
TOB_NEW_CO_Revision_path <- "320001056-18 (App. C Grids)5 - Standard/TOB_NEW_CO_Revision.shp"
```

```{r}
# Reading in data

MHWLJP_2012 <- st_read(MHWLJP_path)
lines_parcels <- st_read(Lines_Parcels_path)
lower_parcel_boundary <- st_read(Lower_parcel_boundary_path)
ordinary_high_WLJP <- st_read(Ordinary_HighWLJP_path)
ordinary_low_WLJP <- st_read(Ordinary_LowWLJP_path)
ra_polygons <- st_read(RA_Polygons_path)
tob_new_co_revision <- st_read(TOB_NEW_CO_Revision_path)
```

```{r}
plot(MHWLJP_2012["geometry"])
plot(lines_parcels["geometry"])
plot(lower_parcel_boundary["geometry"])
plot(ordinary_high_WLJP["geometry"])
plot(ordinary_low_WLJP["geometry"])
plot(ra_polygons["geometry"])
plot(tob_new_co_revision["geometry"])
```


```{r}
AppGrids <- st_read("320001056-18 (App. C Grids)5.dxf")
```


```{r}
str(AppGrids)
```

```{r}
unique(AppGrids$Layer)
```

```{r}
eda_shp <- filter(AppGrids, Layer == "Text")
plot(eda_shp["geometry"])
```

```{r}
decision_units <- c("DU-01", "DU-02", "DU-03", "DU-04", "DU-05", "DU-06", "DU-07", "DU-08", "DU-09", "DU-10", "DU-11", "DU-12", "DU-13", "DU-14", "DU-15", "DU-16", "DU-17", "DU-18", "DU-19", "DU-20", "DU-21", "DU-22", "DU-23", "DU-24", "DU-25", "DU-26", "DU-27", "DU-28", "DU-29", "DU-30", "DU-31", "DU-32", "DU-33", "DU-34", "DU-35", "DU-36", "DU-37", "DU-38", "DU-39", "DU-40", "DU-41", "DU-42", "DU-43", "DU-44")

DU <- filter(AppGrids, Layer %in% decision_units)
DU <- filter(AppGrids, Layer == "00 Grid Areas")
DU <- filter(AppGrids, Layer == "Default_taxlots_1")
DU <- filter(AppGrids, Layer == "Default_taxlots_1" | Layer == "00 Grid Areas")
DU <- filter(AppGrids, Layer %in% decision_units | Layer == "Default_taxlots_1")
plot(DU["geometry"])
```

```{r}
parcels <- filter(AppGrids, Layer == "SHP_POLY")
plot(parcels["geometry"])
```
```{r}
single_du <- filter(DU, EntityHandle == "B653")
plot(single_du["geometry"])
```
```{r}
# ChatGPT work:

# Check if the geometries are valid
validity <- st_is_valid(DU)
invalid_geometries <- DU[!validity, ]

# Print invalid geometries if any
if (nrow(invalid_geometries) > 0) {
    print(invalid_geometries)
} else {
    print("All geometries are valid.")
}
```
```{r}
# Check the geometry types
geometry_types <- st_geometry_type(DU)
print(table(geometry_types))
```
```{r}
st_crs(DU) <- 2261
```

```{r}
DU <- filter(DU, EntityHandle != "17ADF")
```


```{r}
ggplot(data = DU) +
  geom_sf() +
  theme_minimal() +
  ggtitle("Spatial Data with LINESTRING Geometries")
```




NOTES:

Important layers for us: 
- 00 Grid Areas: base layer for DUs
- 00 Grid Areas - TEXT: text labels for DUs
- SHP_POLY: base layer for parcels
- Default_taxlots_1: extraneous details about the area
- 0-ANNO_TEXT: text labels


